---
title: "Building Tidy Data"
author: "Ian Dinwoodie"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(echo=TRUE)
```

# Loading the Data

Load the raw data and verify its dimensions and structure.

```{r}
df <- read.csv('../data/dogs.csv', header=TRUE, skipNul=TRUE)
dim(df)
str(df)
```

We see that we have 1095 responses across 26 fields. The columns names are not
quite servicable in their current state, so we rename them for ease of use.

```{r}
names <- c(
  'acq_12_wo_or_less',
  'at_least_1yo',
  'age_yrs',
  'sex',
  'neutered',
  'train_6mo_or_less',
  'train_age',
  'train_class_count',
  'train_technique',
  'restr_device',
  'aggression',
  'fear_anxiety',
  'jumping',
  'barking',
  'coprophagia',
  'compulsion',
  'soil_when',
  'soil_how',
  'soil_where',
  'rep_materials',
  'hyperactive',
  'destructive',
  'escape',
  'mounting',
  'take_again',
  'owner_id'
)
colnames(df) <- names
str(df)
```

# Specifying Data Types

## Continious

We don't want to interpret every column as characters (`chr`), let's start by
specifying the continuous variables.

```{r}
df$age_yrs <- as.integer(df$age_yrs)
summary(df$age_yrs)
```

## Discrete

### Factors

We convert a bulk of the columns to factors.

```{r}
factors <- c(
  'acq_12_wo_or_less',
  'at_least_1yo',
  'sex',
  'neutered',
  'train_age',
  'train_class_count',
  'train_technique',
  'restr_device',
  'aggression',
  'fear_anxiety',
  'jumping',
  'barking',
  'coprophagia',
  'compulsion',
  'soil_when',
  'soil_how',
  'soil_where',
  'rep_materials',
  'hyperactive',
  'destructive',
  'escape',
  'mounting',
  'owner_id'
)

for (c in factors) {
  df[, c] <- as.factor(df[, c])
}

str(df[, factors])
```

### Boolean

It's clear that some factor columns can be converted to boolean (i.e., logical).

```{r}
df <- df %>%
  mutate(at_least_1yo = ifelse(at_least_1yo == 'Yes', TRUE, FALSE)) %>%
  mutate(neutered = ifelse(neutered == 'Yes', TRUE, FALSE)) %>%
  mutate(aggression = ifelse(aggression == "", FALSE, TRUE)) %>%
  mutate(fear_anxiety = ifelse(fear_anxiety == "", FALSE, TRUE)) %>%
  mutate(jumping = ifelse(jumping == "", FALSE, TRUE)) %>%
  mutate(barking = ifelse(barking == "", FALSE, TRUE)) %>%
  mutate(coprophagia = ifelse(coprophagia == "", FALSE, TRUE)) %>%
  mutate(compulsion = ifelse(compulsion == "", FALSE, TRUE)) %>%
  mutate(house_soiling = ifelse(
    soil_when != "" | soil_how != "" | soil_where != "", FALSE, TRUE)) %>%
  mutate(rep_materials = ifelse(rep_materials == "", FALSE, TRUE)) %>%
  mutate(hyperactive = ifelse(hyperactive == "", FALSE, TRUE)) %>%
  mutate(destructive = ifelse(destructive == "", FALSE, TRUE)) %>%
  mutate(escape = ifelse(escape == "", FALSE, TRUE)) %>%
  mutate(mounting = ifelse(mounting == "", FALSE, TRUE))

str(df)
```

# Deriving Columns

We derive some columns for ease of use and improved clarity.

```{r}
df <- df %>%
  mutate(male = ifelse(df$sex == 'Male', FALSE, TRUE))
str(df)
```

# Applying Inclusion Criteria

```{r}
df <- filter(df, at_least_1yo == TRUE, age_yrs >= 1, age_yrs <= 35)
```

# Dropping Columns

Drop columns that serve no purpose with the analysis.

```{r}
df <- subset(df, select=-c(take_again, soil_when, soil_how, soil_where,
                           at_least_1yo))
```

# Final Summary of Data

Take a last look at the data before saving it to disk.

```{r}
dim(df)
summary(df)
```

# Saving the Tidy Data

Save the data to a file in RDS format so that the data types are saved and so
that the output is compressed.

```{r}
saveRDS(df, '../data/tidy.Rds')
```
